{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Статичные данные процесса",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking \"Execute Workflow\"": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Статичные данные процесса",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Статичные данные процесса": {
      "main": [
        [
          {
            "node": "Google Sheets2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Запись данных в traks",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets2": {
      "main": [
        [
          {
            "node": "Убираем пустые строки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Убираем пустые строки": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "СЗПЦ10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Получаем данные проверяемой страницы",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получаем данные проверяемой страницы": {
      "main": [
        [
          {
            "node": "Получаем строки с треком",
            "type": "main",
            "index": 0
          },
          {
            "node": "СЗПЦ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получаем строки с треком": {
      "main": [
        [
          {
            "node": "проверяем трекномер на соответствие шаблону белпо1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получаем свойства заказа5": {
      "main": [
        [
          {
            "node": "Google Sheets3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets3": {
      "main": [
        [
          {
            "node": "YGP7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "проверяем трекномер на соответствие шаблону белпо1": {
      "main": [
        [
          {
            "node": "Получаем свойства заказа5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "СЗПЦ": {
      "main": [
        [
          {
            "node": "Погружаемся глубже в сбор треков",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "СЗПЦ10": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing13": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Запись данных в traks": {
      "main": [
        [
          {
            "node": "YGP6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "YGP6": {
      "main": [
        [
          {
            "node": "Google Sheets2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "YGP7": {
      "main": [
        [
          {
            "node": "СЗПЦ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ждун": {
      "main": [
        [
          {
            "node": "No Operation, do nothing13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Погружаемся глубже в сбор треков": {
      "main": [
        [
          {
            "node": "Ждун",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2023-11-29T07:05:50.659Z",
  "id": "pwofnTe8IYGRQZrS",
  "meta": null,
  "name": "TrackCollect",
  "nodes": [
    {
      "parameters": {
        "path": "modul_trackCollect",
        "options": {}
      },
      "id": "0250a58b-26fc-4d49-8d72-3b9176ec164f",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        480,
        300
      ],
      "webhookId": "10890d55-af06-4ba9-a3d6-840cd2d62510"
    },
    {
      "parameters": {},
      "id": "f4057c71-4ceb-48df-b825-c359e175a12f",
      "name": "When clicking \"Execute Workflow\"",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        480,
        560
      ]
    },
    {
      "parameters": {
        "jsCode": "return(\n  [\n  {\n    \"headers\": {\n      \"host\": \"n8ns.makees.site\",\n      \"user-agent\": \"axios/0.21.4\",\n      \"content-length\": \"167\",\n      \"accept\": \"application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7\",\n      \"content-type\": \"application/json\",\n      \"x-forwarded-for\": \"172.18.0.1\",\n      \"x-forwarded-host\": \"n8ns.makees.site\",\n      \"x-forwarded-port\": \"443\",\n      \"x-forwarded-proto\": \"https\",\n      \"x-forwarded-server\": \"e8109027b64a\",\n      \"x-real-ip\": \"172.18.0.1\",\n      \"accept-encoding\": \"gzip\"\n    },\n    \"params\": {},\n    \"query\": {},\n    \"body\": {\n      \"processID\": \"ZsTest\",\n      \"main_tableID\": \"1E2_AUgkcpy0BrVZotmTyCH2Uy8ShDSkNZCpCddFwL-A\",\n      \"main_pageID\": 1600679549,\n      \"url_become\": \"https://n8ns.makees.site/webhook-waiting/23\"\n    }\n  }\n]\n);"
      },
      "id": "1a1ad283-a579-408f-b45a-e58b7f83e830",
      "name": "Code",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        740,
        560
      ],
      "disabled": true
    },
    {
      "parameters": {
        "fields": {
          "values": [
            {
              "name": "processID",
              "stringValue": "={{ $json.body.processID }}"
            },
            {
              "name": "main_tableID",
              "stringValue": "={{ $json.body.main_tableID }}"
            },
            {
              "name": "main_pageID",
              "type": "numberValue",
              "numberValue": "={{ $json.body.main_pageID }}"
            },
            {
              "name": "url_become",
              "stringValue": "={{ $json.body.url_become }}"
            }
          ]
        },
        "options": {}
      },
      "id": "22241b89-682f-427d-9801-ecce0e0ca612",
      "name": "Статичные данные процесса",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [
        720,
        300
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $json.main_tableID }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.main_pageID }}",
          "mode": "id"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Чек-бокс",
              "lookupValue": "true"
            }
          ]
        },
        "options": {
          "returnAllMatches": "returnAllMatches"
        }
      },
      "id": "75dde8f9-4de6-4c93-849d-2325688193c5",
      "name": "Google Sheets2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        960,
        300
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "GsKpjBhTzM4aUjza",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.Страница }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "9c0d5f96-8aa8-4ddb-9859-dbecd2dfb108",
      "name": "Убираем пустые строки",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1180,
        300
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "baf49b2e-1a7a-479c-b40d-93d977c904c3",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1460,
        280
      ]
    },
    {
      "parameters": {
        "options": {
          "dotNotation": false
        }
      },
      "id": "52142fd5-61ae-43ef-890c-a7394f4d1b6a",
      "name": "Получаем данные проверяемой страницы",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        1840,
        300
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.трек }}",
              "operation": "isNotEmpty"
            }
          ]
        }
      },
      "id": "1c53066e-0f39-43cb-8678-d24513980dac",
      "name": "проверяем трекномер на соответствие шаблону белпо1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1820,
        -120
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $json.Таблица }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.Страница }}",
          "mode": "id"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Отметка о доставке",
              "lookupValue": "Не доставлено"
            }
          ]
        },
        "options": {
          "returnAllMatches": "returnAllMatches"
        }
      },
      "id": "23c6bd1a-ae4f-4665-99a7-63b984771524",
      "name": "Получаем строки с треком",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        1740,
        100
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "GsKpjBhTzM4aUjza",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "number": [
            {
              "name": "row_number",
              "value": "={{ $json.row_number }}"
            }
          ],
          "string": [
            {
              "name": "трек",
              "value": "={{ $json.трек.toUpperCase() }}"
            },
            {
              "name": "индекс",
              "value": "={{ $json.Индекс }}"
            }
          ]
        },
        "options": {
          "dotNotation": false
        }
      },
      "id": "157cd9f3-ba5f-4329-9489-ee9b35fba729",
      "name": "Получаем свойства заказа5",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        1920,
        -340
      ],
      "executeOnce": false
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Получаем данные проверяемой страницы').item.json.Таблица }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $('Получаем данные проверяемой страницы').item.json.Страница }}",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Индекс": "={{ $json.индекс }}",
            "трек": "={{ $json.трек }}"
          },
          "matchingColumns": [
            "Индекс"
          ],
          "schema": [
            {
              "id": "число",
              "displayName": "число",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "фио менеджера",
              "displayName": "фио менеджера",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "фио покупателя",
              "displayName": "фио покупателя",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "продажа",
              "displayName": "продажа",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "без накрута",
              "displayName": "без накрута",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "накрут",
              "displayName": "накрут",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "трек",
              "displayName": "трек",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "невостреб",
              "displayName": "невостреб",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "наличие",
              "displayName": "наличие",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "личный",
              "displayName": "личный",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Отметка о доставке",
              "displayName": "Отметка о доставке",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Индекс",
              "displayName": "Индекс",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Дата последнего обновления",
              "displayName": "Дата последнего обновления",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            }
          ]
        },
        "options": {}
      },
      "id": "b098eec3-6f1e-4c4d-85c6-821c2c392e88",
      "name": "Google Sheets3",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [
        2180,
        -340
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "GsKpjBhTzM4aUjza",
          "name": "Google Sheets account"
        }
      },
      "continueOnFail": true
    },
    {
      "parameters": {
        "content": "## Подмодуль увеличения регистра для треков",
        "height": 348.4244308747857,
        "width": 538.8801317324187
      },
      "id": "9b50dfca-2a5d-434e-9da7-328ae683639a",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1860,
        -480
      ]
    },
    {
      "parameters": {
        "url": "={{ $('Статичные данные процесса').first().json.url_become }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "TrackCollect",
              "value": "OK"
            }
          ]
        },
        "options": {}
      },
      "id": "d777a89d-5781-4895-bb9d-dfcb85d9d573",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1400,
        -100
      ]
    },
    {
      "parameters": {},
      "id": "1eeb1746-f239-4cfb-88de-c5f5eac91ee4",
      "name": "No Operation, do nothing13",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2860,
        600
      ]
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "options": {
          "dotNotation": false
        }
      },
      "id": "ac0b3cf5-71f4-4b54-9914-e17eb2576c21",
      "name": "СЗПЦ",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        2220,
        300
      ],
      "executeOnce": true,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "options": {
          "dotNotation": false
        }
      },
      "id": "c9555fdd-c7a4-4d4f-92e7-7ff85060fc39",
      "name": "СЗПЦ10",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        1440,
        60
      ],
      "executeOnce": true,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "opWrite",
        "queryPath": "traks",
        "sourceType": "sourceTypeJson",
        "sourceData": "={\n\"BP_traks\": \n{\n},\n\"EP_traks\": \n{\n}\n}",
        "filePath": "=root/n8n/{{ $json.processID }}.json"
      },
      "id": "e6c30c05-2d09-4ac6-a255-5e6ffa27ed45",
      "name": "Запись данных в traks",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        800,
        80
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value2": true
            }
          ]
        }
      },
      "id": "43ff8b30-6868-4a83-a17d-10c08415d6f8",
      "name": "YGP6",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1020,
        80
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value2": true
            }
          ]
        }
      },
      "id": "9816cc59-261d-4ba5-8145-da5708e47a75",
      "name": "YGP7",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        2240,
        20
      ],
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "resume": "webhook",
        "options": {}
      },
      "id": "4d956d53-47fb-4f0a-b9ea-b2e396e78247",
      "name": "Ждун",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        2860,
        300
      ],
      "webhookId": "0c0baebd-5e33-4d1e-a59b-ec65d7f4b6b8"
    },
    {
      "parameters": {
        "url": "https://n8n.makees.online/webhook/deep_TC",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "=processID",
              "value": "={{ $('Статичные данные процесса').item.json.processID }}"
            },
            {
              "name": "check_tableID",
              "value": "={{ $('Получаем данные проверяемой страницы').item.json.Таблица }}"
            },
            {
              "name": "check_pageID",
              "value": "={{ $('Получаем данные проверяемой страницы').item.json.Страница }}"
            },
            {
              "name": "url_become",
              "value": "={{ $execution.resumeUrl }}"
            }
          ]
        },
        "options": {}
      },
      "id": "a6905103-f65d-45b6-b4ce-1732ee95f743",
      "name": "Погружаемся глубже в сбор треков",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2540,
        300
      ]
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "k3cmqrd2rdjhkgrK"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2023-12-29T05:49:12.607Z",
      "updatedAt": "2023-12-29T05:49:12.607Z",
      "id": "2F2JpICiTQCMNk1Q",
      "name": "treck_check"
    },
    {
      "createdAt": "2023-12-29T05:48:03.050Z",
      "updatedAt": "2023-12-29T05:48:03.050Z",
      "id": "AgzDK5Bx0yz5Db7h",
      "name": "json"
    },
    {
      "createdAt": "2023-12-29T05:48:23.798Z",
      "updatedAt": "2023-12-29T05:48:23.798Z",
      "id": "UR0e0BgkatF4AB4O",
      "name": "potap"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2024-02-01T12:14:48.000Z",
  "versionId": "031b04a8-1c75-41ab-ada1-c511ce541d1e"
}