{
  "active": true,
  "connections": {
    "Проверка оплаты": {
      "main": [
        [
          {
            "node": "Получить все записи из таблицы Users",
            "type": "main",
            "index": 0
          },
          {
            "node": "Подготовка перед работай с переменной3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Проверяем что до оплаты больше 3 дней": {
      "main": [
        [
          {
            "node": "тут нода в которую отправляем тех пользователей , у которых всё ок",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Собираем тех, у кого остаётся менее 3х дней до оплаты",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Считаем оставшееся колличество дней до оплаты": {
      "main": [
        [
          {
            "node": "Проверяем что до оплаты больше 3 дней",
            "type": "main",
            "index": 0
          },
          {
            "node": "JsonDatabase2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Проверяем у кого истёк срок оплаты": {
      "main": [
        [
          {
            "node": "Считаем оставшееся колличество дней до оплаты",
            "type": "main",
            "index": 0
          },
          {
            "node": "JsonDatabase4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Выставляем Nok в Status тем, у кого просрочена оплата",
            "type": "main",
            "index": 0
          },
          {
            "node": "Собираем всех с истёкшим сроком оплаты",
            "type": "main",
            "index": 0
          },
          {
            "node": "JsonDatabase3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ПРОверяем статус подписки": {
      "main": [
        [
          {
            "node": "Проверяем у кого истёк срок оплаты",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Выставляем 0 в WorkOn тем, у кого статус подписки Nok",
            "type": "main",
            "index": 0
          },
          {
            "node": "Собираем тех, у кого WorkOn выставлен 0",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "Проверка оплаты",
            "type": "main",
            "index": 0
          },
          {
            "node": "формируем запрос к логированию",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получить все записи из таблицы Users": {
      "main": [
        [
          {
            "node": "ПРОверяем статус подписки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "тут нода в которую отправляем тех пользователей , у которых всё ок": {
      "main": [
        [
          {
            "node": "СЗПЦ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Собираем тех, у кого WorkOn выставлен 0": {
      "main": [
        [
          {
            "node": "Подготовка перед работай с переменной",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Проверка оплаты",
            "type": "main",
            "index": 0
          },
          {
            "node": "формируем запрос к логированию",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "СЗПЦ": {
      "main": [
        [
          {
            "node": "JsonDatabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Собираем request": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Получить все записи из таблицы Users",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Подготовка перед работай с переменной": {
      "main": [
        [
          {
            "node": "отправка в процесс работы с переменной",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Подготовка перед работай с переменной1": {
      "main": [
        [
          {
            "node": "отправка в процесс работы с переменной1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Собираем всех с истёкшим сроком оплаты": {
      "main": [
        [
          {
            "node": "Подготовка перед работай с переменной1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Подготовка перед работай с переменной2": {
      "main": [
        [
          {
            "node": "отправка в процесс работы с переменной2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Собираем тех, у кого остаётся менее 3х дней до оплаты": {
      "main": [
        [
          {
            "node": "Подготовка перед работай с переменной2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Подготовка перед работай с переменной3": {
      "main": [
        [
          {
            "node": "отправка в процесс работы с переменной3",
            "type": "main",
            "index": 0
          },
          {
            "node": "JsonDatabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка в процесс работы с переменной3": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка в процесс работы с переменной": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка в процесс работы с переменной1": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "отправка в процесс работы с переменной2": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "тут нода в которую отправляем тех пользователей , у которых всё ок",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Подтягиваем все значения переменной user_trabls": {
      "main": [
        [
          {
            "node": "Собираем request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JsonDatabase": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JsonDatabase2": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Подтягиваем все значения переменной user_trabls1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JsonDatabase1": {
      "main": [
        [
          {
            "node": "Подтягиваем все значения переменной user_trabls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Подтягиваем все значения переменной user_trabls1": {
      "main": [
        [
          {
            "node": "Собираем request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Собираем request1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "формируем запрос к логированию": {
      "main": [
        [
          {
            "node": "Запрос в процесс логирования",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          },
          {
            "node": "формируем запрос к логированию1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "формируем запрос к логированию1": {
      "main": [
        [
          {
            "node": "Запрос в процесс логирования1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JsonDatabase3": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Подтягиваем все значения переменной user_trabls1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JsonDatabase4": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Считаем оставшееся колличество дней до оплаты",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-10-20T13:05:09.344Z",
  "id": "aumuEuypCPDeduJl",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Проверка оплаты",
  "nodes": [
    {
      "parameters": {},
      "id": "78ed46b9-3c93-4d1c-ba10-680321184fd0",
      "name": "Проверка оплаты",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        900,
        360
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "57fa4b0e-cca4-4551-b0c3-6acc60da4398",
              "leftValue": "={{ $json.timeDifference.days }}",
              "rightValue": 3,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "e4c2293d-8d2f-469f-8d8d-4735a9aebaf8",
      "name": "Проверяем что до оплаты больше 3 дней",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2160,
        340
      ]
    },
    {
      "parameters": {
        "operation": "getTimeBetweenDates",
        "startDate": "={{ $today }}",
        "endDate": "={{ $json.DateNextPay }}",
        "options": {
          "includeInputFields": true
        }
      },
      "id": "e5edda2d-476e-4362-afd4-7415a4689aa6",
      "name": "Считаем оставшееся колличество дней до оплаты",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        1940,
        320
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4a97b329-1205-4c32-a83a-d5f6aa6fba0f",
              "leftValue": "={{ $today }}",
              "rightValue": "={{ $json.DateNextPay }}",
              "operator": {
                "type": "dateTime",
                "operation": "before"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ad09128a-7c50-4329-af7f-18faf5daf282",
      "name": "Проверяем у кого истёк срок оплаты",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1700,
        340
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Users",
          "mode": "list",
          "cachedResultName": "Users"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "ID",
        "valueToMatchOn": "={{ $json.ID }}",
        "valuesToSend": {
          "values": [
            {
              "column": "WorkOn",
              "value": "0"
            }
          ]
        },
        "options": {}
      },
      "id": "d262e67e-7e90-42c7-82d1-aa6063d84b9e",
      "name": "Выставляем 0 в WorkOn тем, у кого статус подписки Nok",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1460,
        120
      ],
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "5ea1652c-f08e-4b32-abdc-b376482ed786",
              "leftValue": "={{ $json.Status }}",
              "rightValue": "ok",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "588200da-a229-4e5c-8d8a-2d5e0f91c95c",
      "name": "ПРОверяем статус подписки",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1480,
        360
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Users",
          "mode": "list",
          "cachedResultName": "Users"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "ID",
        "valueToMatchOn": "={{ $json.ID }}",
        "valuesToSend": {
          "values": [
            {
              "column": "WorkOn",
              "value": "0"
            }
          ]
        },
        "options": {}
      },
      "id": "0af123ef-6fb0-4686-9a3b-7e85a9a3a996",
      "name": "Выставляем Nok в Status тем, у кого просрочена оплата",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1700,
        120
      ],
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {},
      "id": "6db80238-08a4-465e-bf6f-95d06a103438",
      "name": "тут нода в которую отправляем тех пользователей , у которых всё ок",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2440,
        300
      ]
    },
    {
      "parameters": {
        "content": "#  Проверка оплаты",
        "height": 165.41775750134093,
        "width": 390.9707681515789,
        "color": 4
      },
      "id": "28d43fa0-8893-4772-a1a3-47c63374dcf3",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        80,
        20
      ]
    },
    {
      "parameters": {},
      "id": "34d8b54d-2cb4-49bb-ab85-cb13b895d68c",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        540,
        480
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM Users ",
        "options": {}
      },
      "id": "caa9755a-cdfb-4e16-9489-82ad947202f1",
      "name": "Получить все записи из таблицы Users",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1240,
        360
      ],
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "url": "https://n8n.makeesn8n.online/webhook/proceses_control",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "Error",
              "value": "={{ $json.Error }}"
            },
            {
              "name": "Ditales",
              "value": "={{ $json.Ditales }}"
            },
            {
              "name": "From",
              "value": "={{ $json.From }}"
            }
          ]
        },
        "options": {}
      },
      "id": "27d7a8a4-0de0-4644-af84-4ca588a37b92",
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3780,
        500
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "67797e6a-dcf6-4b16-bc97-a01c11094613",
              "name": "Error",
              "value": "no",
              "type": "string"
            },
            {
              "id": "cf26a33d-0781-4a07-a7df-b756f3703858",
              "name": "Ditales",
              "value": "=InfoUserData:{{ JSON.stringify($json.data) }}",
              "type": "string"
            },
            {
              "id": "85fd636e-edfe-4d59-b17c-1c2d08edfc53",
              "name": "From",
              "value": "pay_check",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "c65cb8b0-5260-4283-a096-1923ebac836d",
      "name": "Собираем request",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3340,
        400
      ]
    },
    {
      "parameters": {
        "operation": "concatenateItems",
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "ec42b91d-1bd6-4c5d-8fe0-eeb3a2a9a056",
      "name": "Собираем тех, у кого WorkOn выставлен 0",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        1380,
        -180
      ]
    },
    {
      "parameters": {
        "operation": "concatenateItems",
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "325bb810-a27e-4f0e-b7d8-b396d56ad50f",
      "name": "Собираем всех с истёкшим сроком оплаты",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        1660,
        -180
      ]
    },
    {
      "parameters": {
        "operation": "concatenateItems",
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "74c65c24-498d-4377-98ed-53fe50712210",
      "name": "Собираем тех, у кого остаётся менее 3х дней до оплаты",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        1940,
        -180
      ]
    },
    {
      "parameters": {
        "path": "pay_check",
        "options": {}
      },
      "id": "af9e07c9-4791-4e55-bbcd-cbb3720c0273",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        540,
        260
      ],
      "webhookId": "dc78042c-7079-4714-b064-12c110dc52d7"
    },
    {
      "parameters": {
        "keepOnlySet": true,
        "options": {
          "dotNotation": false
        }
      },
      "id": "f2809b8a-db25-423a-8213-d6ae57b0fe15",
      "name": "СЗПЦ",
      "type": "n8n-nodes-base.set",
      "typeVersion": 1,
      "position": [
        2640,
        300
      ],
      "executeOnce": true,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c0d39e9f-91c2-42d4-af50-1fc03f7dbc47",
              "leftValue": false,
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "79c08af4-9cb8-42e1-8687-ab7781cfb415",
      "name": "If2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1200,
        120
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e42c85c3-ac65-4414-bcd4-ad1697231710",
              "name": "data",
              "value": "={{ $json.data }}",
              "type": "array"
            },
            {
              "id": "6c458ee7-e6a0-4781-898d-2656f2d1e637",
              "name": "var_name",
              "value": "user_trabls",
              "type": "string"
            },
            {
              "id": "b32c4a00-5acb-421a-85d4-d01c4470798a",
              "name": "operation",
              "value": "update",
              "type": "string"
            },
            {
              "id": "8a87e6d8-15a5-4199-9daf-106a8e88ba34",
              "name": "parametr",
              "value": "WorkOn_0",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "0823fce2-114a-409e-b69a-ad1ff5f898bf",
      "name": "Подготовка перед работай с переменной",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1100,
        -360
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e42c85c3-ac65-4414-bcd4-ad1697231710",
              "name": "data",
              "value": "={{ $json.data }}",
              "type": "array"
            },
            {
              "id": "6c458ee7-e6a0-4781-898d-2656f2d1e637",
              "name": "var_name",
              "value": "user_trabls",
              "type": "string"
            },
            {
              "id": "b32c4a00-5acb-421a-85d4-d01c4470798a",
              "name": "operation",
              "value": "add",
              "type": "string"
            },
            {
              "id": "c34805ef-06e2-4cbc-bec0-09501417d14b",
              "name": "parametr",
              "value": "LastPay_InPast",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "bb120b1c-bf7c-4811-80dd-0e8d5b15805f",
      "name": "Подготовка перед работай с переменной1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1560,
        -360
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e42c85c3-ac65-4414-bcd4-ad1697231710",
              "name": "data",
              "value": "={{ $json.data }}",
              "type": "array"
            },
            {
              "id": "6c458ee7-e6a0-4781-898d-2656f2d1e637",
              "name": "var_name",
              "value": "user_trabls",
              "type": "string"
            },
            {
              "id": "b32c4a00-5acb-421a-85d4-d01c4470798a",
              "name": "operation",
              "value": "add",
              "type": "string"
            },
            {
              "id": "39dbae7f-ef93-41fd-82e2-7169888b004e",
              "name": "parametr",
              "value": "3daysTOpay",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "79c61f32-6f72-4969-bf83-368ffd458df6",
      "name": "Подготовка перед работай с переменной2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2020,
        -360
      ]
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "KLOTYwG7rXVfZCKr",
          "mode": "list",
          "cachedResultName": "Запись переменной"
        },
        "options": {}
      },
      "id": "eb5ecbd6-69e1-4772-b4a1-ae57b5098056",
      "name": "отправка в процесс работы с переменной",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        1280,
        -360
      ]
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "KLOTYwG7rXVfZCKr",
          "mode": "list",
          "cachedResultName": "Запись переменной"
        },
        "options": {}
      },
      "id": "b7b48b2d-f915-4b8f-908d-d99698555ee8",
      "name": "отправка в процесс работы с переменной1",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        1780,
        -360
      ]
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "KLOTYwG7rXVfZCKr",
          "mode": "list",
          "cachedResultName": "Запись переменной"
        },
        "options": {}
      },
      "id": "0aee16c4-c068-4878-b524-692b4e18de45",
      "name": "отправка в процесс работы с переменной2",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        2180,
        -360
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6c458ee7-e6a0-4781-898d-2656f2d1e637",
              "name": "var_name",
              "value": "user_trabls",
              "type": "string"
            },
            {
              "id": "b32c4a00-5acb-421a-85d4-d01c4470798a",
              "name": "operation",
              "value": "null",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3b270681-23f6-47c4-8555-e5dc721fa7bb",
      "name": "Подготовка перед работай с переменной3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        800,
        120
      ]
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "KLOTYwG7rXVfZCKr",
          "mode": "list",
          "cachedResultName": "Запись переменной"
        },
        "options": {}
      },
      "id": "0a6407a6-05f1-4cf6-883f-f7e9439395b1",
      "name": "отправка в процесс работы с переменной3",
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        1000,
        120
      ]
    },
    {
      "parameters": {
        "operation": "opWrite",
        "queryPath": "data",
        "sourceType": "sourceTypeJson",
        "filePath": "=root/n8n/user_trabls.json"
      },
      "id": "a0044c88-b86f-4b53-acb5-f0e9dfe8acac",
      "name": "Подтягиваем все собранные треки BP из JSON2",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        160,
        -240
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c0d39e9f-91c2-42d4-af50-1fc03f7dbc47",
              "leftValue": false,
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "cb4f4593-d5eb-457e-adf0-7f12d67ce05d",
      "name": "If3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2420,
        -580
      ]
    },
    {
      "parameters": {
        "queryPath": "data",
        "filePath": "=root/n8n/user_trabls.json"
      },
      "id": "6135e159-5058-4094-85ff-304eb49db926",
      "name": "Подтягиваем все значения переменной user_trabls",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        3120,
        400
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "operation": "opWrite",
        "queryPath": "process.trigers",
        "sourceType": "sourceTypeJson",
        "sourceData": "{  \"Triger1\":  0, \"Triger2\":  0 } ",
        "filePath": "=root/n8n/sbor_pay.json"
      },
      "id": "c5258850-c53c-4433-a07a-855ff78b4bc6",
      "name": "JsonDatabase",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        980,
        -60
      ]
    },
    {
      "parameters": {
        "operation": "opWrite",
        "queryPath": "process.trigers",
        "sourceType": "sourceTypeJson",
        "sourceData": "{  \"Triger1\":  1 } ",
        "filePath": "=root/n8n/sbor_pay.json"
      },
      "id": "bbb26c92-c0ed-4078-a1ce-4adcd42349ee",
      "name": "JsonDatabase1",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        2840,
        300
      ]
    },
    {
      "parameters": {
        "queryPath": "process.trigers",
        "filePath": "=root/n8n/sbor_pay.json"
      },
      "id": "10f04dc8-698b-4d1c-8e82-e2038a835bcc",
      "name": "JsonDatabase2",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        2020,
        620
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "41239446-30c9-41b2-8d17-6265eab22947",
              "leftValue": "={{ $json.data.Triger1 }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2380,
        620
      ],
      "id": "43db4fa9-3396-4522-a0c5-4b2adfd8f1d0",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "67797e6a-dcf6-4b16-bc97-a01c11094613",
              "name": "Error",
              "value": "no",
              "type": "string"
            },
            {
              "id": "cf26a33d-0781-4a07-a7df-b756f3703858",
              "name": "Ditales",
              "value": "=message: \"Нет оплаченных и допущенных к проверке пользователей.\" InfoUserData:{{ JSON.stringify($json.data) }}",
              "type": "string"
            },
            {
              "id": "85fd636e-edfe-4d59-b17c-1c2d08edfc53",
              "name": "From",
              "value": "pay_check",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "7061107e-d399-41ec-ad43-e0c649aa1835",
      "name": "Собираем request1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3360,
        600
      ]
    },
    {
      "parameters": {
        "queryPath": "data",
        "filePath": "=root/n8n/user_trabls.json"
      },
      "id": "70b5faa6-ecde-446c-9e41-564798ad2104",
      "name": "Подтягиваем все значения переменной user_trabls1",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        3140,
        600
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d22d35f9-6a2c-4806-926f-fa11b5f5f566",
              "name": "opr",
              "value": "new",
              "type": "string"
            },
            {
              "id": "1899134f-bf98-48f0-a9cf-6a4f89849e2f",
              "name": "poc_name",
              "value": "pay_check",
              "type": "string"
            },
            {
              "id": "e953757c-1e36-4772-9860-f255d33f2d81",
              "name": "message",
              "value": "null",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        540,
        -220
      ],
      "id": "f5ae8398-d7a3-4186-9342-d7e03d6a86b1",
      "name": "формируем запрос к логированию"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "lOtPJcL6AitkSaoP",
          "mode": "list",
          "cachedResultName": "Лог в БД"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        840,
        -220
      ],
      "id": "6c48d2c5-492c-44ec-9ac8-7bc611c7bc7d",
      "name": "Запрос в процесс логирования"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3540,
        500
      ],
      "id": "41ab80bc-010b-4691-a6c3-79ffbe6b7598",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d22d35f9-6a2c-4806-926f-fa11b5f5f566",
              "name": "opr",
              "value": "add",
              "type": "string"
            },
            {
              "id": "1899134f-bf98-48f0-a9cf-6a4f89849e2f",
              "name": "poc_name",
              "value": "pay_check",
              "type": "string"
            },
            {
              "id": "e953757c-1e36-4772-9860-f255d33f2d81",
              "name": "message",
              "value": "=Данные по прецесам на сегодня:\nВ проверке: {{ $('Получить все записи из таблицы Users').all().toJsonString().replaceAll('[{','').replaceAll('{','').replaceAll('\"','').replaceAll('json:','')  }}\nПроблемы:{{ $json.Ditales }}\nFinish: {{ $now.format('HH-mm-ss') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3540,
        240
      ],
      "id": "cec16c07-83a5-4217-a4e4-f5699a15085a",
      "name": "формируем запрос к логированию1"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "lOtPJcL6AitkSaoP",
          "mode": "list",
          "cachedResultName": "Лог в БД"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.1,
      "position": [
        3840,
        240
      ],
      "id": "ae9fe357-bf38-4a1e-a5ff-8f95abfafa6f",
      "name": "Запрос в процесс логирования1"
    },
    {
      "parameters": {
        "queryPath": "process.trigers",
        "filePath": "=root/n8n/sbor_pay.json"
      },
      "id": "b161ff6c-1f26-4507-bb8c-30643203b8eb",
      "name": "JsonDatabase3",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        1760,
        780
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "41239446-30c9-41b2-8d17-6265eab22947",
              "leftValue": "={{ $json.data.Triger2 }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2220,
        780
      ],
      "id": "36b58ff9-92e6-4be1-8220-842dfe36dd87",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "opWrite",
        "queryPath": "process.trigers",
        "sourceType": "sourceTypeJson",
        "sourceData": "{  \"Triger2\":  1 } ",
        "filePath": "=root/n8n/sbor_pay.json"
      },
      "id": "1e2223d1-7960-4c87-84f0-192e7f256350",
      "name": "JsonDatabase4",
      "type": "@n-octo-n/n8n-nodes-json-database.JsonDatabase",
      "typeVersion": 1,
      "position": [
        1920,
        180
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "af474031-69af-4b3c-a813-aef88c419691",
              "leftValue": false,
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2100,
        180
      ],
      "id": "b5fda2f3-b91f-4d1e-bc48-8b95da92d39f",
      "name": "If4"
    },
    {
      "parameters": {
        "content": "## Список всех связанных процессов\n\nКонтролирующий процесс: https://n8n.makeesn8n.online/workflow/bMvuHeBYvdHDiEIe\nПроверка оплаты: https://n8n.makeesn8n.online/workflow/aumuEuypCPDeduJl\nВыставление статусов из БД в гугл таблицы: https://n8n.makeesn8n.online/workflow/h5YM9whrOFCP3UOu\nСбор треков из гугл таблиц: https://n8n.makeesn8n.online/workflow/cFIhZIUCa83nOqy2\nСбор треков из БД: https://n8n.makeesn8n.online/workflow/5OMCiCkLN9V8Gpmw\nПроверка треков БП из БД: https://n8n.makeesn8n.online/workflow/YmijBbofjG27z5Tx\nПроверка треков ЕП из БД: https://n8n.makeesn8n.online/workflow/UC7sB9OYqdYSVdln\n\n## Дополнительные процессы:\nДобавление треков на  проверку в сервера (сбор треков из БД): https://n8n.makeesn8n.online/workflow/4BkOIQhV62y7mbvD\nЛог в БД: https://n8n.makeesn8n.online/workflow/lOtPJcL6AitkSaoP\nРабота с переменными: https://n8n.makeesn8n.online/workflow/KLOTYwG7rXVfZCKr\n\n## Служебные процессы:\nРабота с БД: https://n8n.makeesn8n.online/workflow/BN33z2RD9BacyBSt\nФормы для БД: https://n8n.makeesn8n.online/workflow/bUJavMgjLppjbo49\n",
        "height": 700,
        "width": 500
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -480,
        -360
      ],
      "typeVersion": 1,
      "id": "a7b05eed-4a2f-474b-9781-26bc6993768f",
      "name": "Sticky Note3"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-02-05T16:24:37.889Z",
      "updatedAt": "2025-02-05T16:24:37.889Z",
      "id": "vsUr1hQQVG3ZP6Nk",
      "name": "BDCheck"
    }
  ],
  "triggerCount": 1,
  "updatedAt": "2025-03-19T20:35:32.000Z",
  "versionId": "5f805f95-3fdd-42d1-a412-026c8b2468e2"
}