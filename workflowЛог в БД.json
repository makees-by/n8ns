{
  "active": true,
  "connections": {
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "new",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Создаем новую запись выставляем время старта в БД",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Получаем текущее значение из бд",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Получаем данные изз БД",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Дополняем запись в БД",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "new": {
      "main": [
        [
          {
            "node": "add",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "add": {
      "main": [
        [
          {
            "node": "get",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Получаем текущее значение из бд": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получаем данные изз БД": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-11-15T13:04:14.102Z",
  "id": "lOtPJcL6AitkSaoP",
  "meta": null,
  "name": "Лог в БД",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -160,
        0
      ],
      "id": "b0ff236d-44b0-40f6-afbe-6c4999dbfc8f",
      "name": "When clicking ‘Test workflow’"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8ada4fb1-8dd2-4d28-b5fc-41b7340d01da",
                    "leftValue": "={{ $json.poc_name }}",
                    "rightValue": "proceses_control",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": " proceses_control"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        240,
        -220
      ],
      "id": "b02d70ef-5b95-487f-b0e6-251a1ba75dc3",
      "name": "Switch"
    },
    {
      "parameters": {
        "path": "16e72813-df27-48b5-919d-3598ef546671",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -180,
        -220
      ],
      "id": "0a76d17a-c7bf-4c75-acb6-a33066027ea8",
      "name": "Webhook",
      "webhookId": "1688b730-73f0-4a05-8700-d123c6774504"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.opr }}",
                    "rightValue": "new",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "new"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "eb22547f-6efa-4186-a39c-a7159911affb",
                    "leftValue": "={{ $json.opr }}",
                    "rightValue": "add",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "add"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a5ce2059-7cde-4215-b1df-815d0232aab7",
                    "leftValue": "={{ $json.opr }}",
                    "rightValue": "get",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "get"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        500,
        -60
      ],
      "id": "99dcea07-962e-4006-9d64-058d5e46bd11",
      "name": "Switch1"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        1220,
        -40
      ],
      "id": "e3bb6b85-9908-4674-8002-db8de00b34e2",
      "name": "Merge"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c1b9dd58-7185-46f8-8ab7-ea1495342f13",
              "name": "proceses_control",
              "value": "={{ $json.proceses_control }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1040,
        280
      ],
      "id": "9e83e982-5a9e-45ea-b4a2-68287a2d5da1",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "return(\n[\n  {\n    \"opr\": \"new\",\n    \"poc_name\": \"proceses_control\",\n    \"message\": \"null\"\n  }\n]\n);"
      },
      "id": "803cefb5-ca21-4d61-bb53-f92596938071",
      "name": "new",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        40,
        -120
      ],
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "return(\n[\n  {\n    \"opr\": \"add\",\n    \"poc_name\": \"proceses_control\",\n    \"message\": \"13:42:17 : Отправлен запрос на выставление статуса треков из БД в гугл таблицы.\\n\"\n  }\n]\n);"
      },
      "id": "8c66adfb-8056-4d57-ad06-d1eea345fbc3",
      "name": "add",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        40,
        80
      ],
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "return(\n[\n  {\n    \"opr\": \"get\",\n    \"poc_name\": \"proceses_control\",\n    \"message\": \"\"\n  }\n]\n);"
      },
      "id": "048813f3-19d2-4a04-8fbe-638b332a2345",
      "name": "get",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        220,
        180
      ],
      "disabled": true
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "={{ $('Switch1').item.json.poc_name }}",
              "renameField": true,
              "outputFieldName": "data"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1020,
        80
      ],
      "id": "2fe4fe64-ca12-4cbb-9eb3-c5f56db07f43",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "Logs",
          "mode": "list",
          "cachedResultName": "Logs"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "Id",
              "value": "=TC{{ $today.format('dd.MM.yyyy') }}BD"
            }
          ]
        },
        "combineConditions": "=AND",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        800,
        80
      ],
      "id": "c49b810c-8e2e-49b3-9f23-f3eef19cffd2",
      "name": "Получаем текущее значение из бд",
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Logs",
          "mode": "list",
          "cachedResultName": "Logs"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "Id",
        "valueToMatchOn": "={{ $('Получаем текущее значение из бд').item.json.Id }}",
        "valuesToSend": {
          "values": [
            {
              "column": "={{ $json.poc_name }}",
              "value": "={{ $json.data[0] }}\n{{ $json.message }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1420,
        -40
      ],
      "id": "8edc9fb8-cfd4-4487-84aa-f36e51cffa88",
      "name": "Дополняем запись в БД",
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "table": {
          "__rl": true,
          "value": "Logs",
          "mode": "list",
          "cachedResultName": "Logs"
        },
        "dataMode": "defineBelow",
        "valuesToSend": {
          "values": [
            {
              "column": "Id",
              "value": "=TC{{ $today.format('dd.MM.yyyy') }}BD"
            },
            {
              "column": "={{ $json.poc_name }}",
              "value": "=Start: {{ $now.format('HH.mm.ss') }}\n"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        800,
        -260
      ],
      "id": "b7adc1ce-41c5-4604-9ac8-442616fa3367",
      "name": "Создаем новую запись выставляем время старта в БД",
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "Logs",
          "mode": "list",
          "cachedResultName": "Logs"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "Id",
              "value": "=TC{{ $today.format('dd.MM.yyyy') }}BD"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        560,
        240
      ],
      "id": "29d60d2c-4f66-4774-a822-7b4db7854576",
      "name": "Получаем данные изз БД",
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "={{ $('Switch1').item.json.poc_name }}",
              "renameField": true,
              "outputFieldName": "={{ $('Switch1').item.json.poc_name }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        780,
        260
      ],
      "id": "083965a6-1131-4388-966f-79ecf688996e",
      "name": "Aggregate1"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2024-11-17T15:22:29.000Z",
  "versionId": "2a07f7a9-d314-4691-ab0c-ba34a07ae0d8"
}