{
  "active": true,
  "connections": {
    "Распаковываем массив с треками": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          },
          {
            "node": "Произведём логические расчёты для Servers в БД",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "выставляем status work - 0",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Трэк в цикле",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Трэк в цикле": {
      "main": [
        [
          {
            "node": "Date & Time",
            "type": "main",
            "index": 0
          },
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing3": {
      "main": [
        [
          {
            "node": "разница",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "разница": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Выставляем в БД табл Traks статус Доставлено отправителю": {
      "main": [
        [
          {
            "node": "No Operation, do nothing3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Выставляем в БД табл Traks статус Доставлено": {
      "main": [
        [
          {
            "node": "No Operation, do nothing3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Выставляем в БД табл Traks статус Доставлено1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Date & Time": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Получить все записи из таблицы Servers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Произведём логические расчёты для Servers в БД": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Закидываем колличество треков в таблицу Servers для сервера BP_1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Закидываем колличество треков в таблицу Servers для сервера BP_1": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получить все записи из таблицы Servers": {
      "main": [
        [
          {
            "node": "Уменьшаем на 1 количество оставшихся треков",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Уменьшаем на 1 количество оставшихся треков": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получить все записи из таблицы Servers для BP_X": {
      "main": [
        [
          {
            "node": "Получаем треки в массив",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Получаем треки в массив": {
      "main": [
        [
          {
            "node": "Распаковываем массив с треками",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Данные процесса": {
      "main": [
        [
          {
            "node": "Получить все записи из таблицы Servers для BP_X",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Test workflow’": {
      "main": [
        [
          {
            "node": "Данные процесса",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Aggregate1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate1": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Aggregate2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate2": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "выставляем status work - 0": {
      "main": [
        [
          {
            "node": "Отправляем уведомление об окончании проверки",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Выставляем в БД табл Traks статус Доставлено",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Выставляем в БД табл Traks статус Доставлено отправителю",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Выставляем в БД табл Traks статус Доставлено1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Данные процесса",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-11-03T16:36:45.367Z",
  "id": "UC7sB9OYqdYSVdln",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Проверка треков ЕП из БД",
  "nodes": [
    {
      "parameters": {},
      "id": "75db125c-974e-4d42-ae7f-1b3b51cd0171",
      "name": "When clicking ‘Test workflow’",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        660,
        580
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "body",
        "options": {}
      },
      "id": "190042b9-853c-443a-b776-60f6fac7bfdc",
      "name": "Распаковываем массив с треками",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 3,
      "position": [
        1200,
        340
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "9c8f63fc-adf8-4a01-80b5-537c31e1e89d",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1620,
        340
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9bab58ba-391d-4429-bd78-258a475469a8",
              "name": "Track",
              "value": "={{ $json.Track }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "0af46635-cd6c-4ede-b433-d9676ce120d0",
      "name": "Трэк в цикле",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1880,
        440
      ]
    },
    {
      "parameters": {},
      "id": "b39a693a-f5ef-40ee-96bc-6461adef32aa",
      "name": "No Operation, do nothing3",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3980,
        940
      ]
    },
    {
      "parameters": {
        "operation": "getTimeBetweenDates",
        "startDate": "={{ $('Date & Time').first().json.currentDate }}",
        "endDate": "={{ $now }}",
        "units": [
          "second"
        ],
        "options": {}
      },
      "id": "c3fd912d-e587-447c-ac8b-81a04fef66d7",
      "name": "разница",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        4200,
        940
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "e79248ef-02b4-4d93-8c40-2e478a3bac34",
              "leftValue": "={{ 35 - $json.timeDifference.seconds }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "ab02f793-b703-44ce-89df-b6eec2a7d2f9",
      "name": "If1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        4380,
        940
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5f9f64ef-8fab-4fc7-a42b-31640b614086",
              "name": "timer",
              "value": "={{42- $json.timeDifference.seconds }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "fcb0a290-28a6-4485-9fca-fdeee57411ca",
      "name": "Edit Fields3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        4640,
        780
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5f9f64ef-8fab-4fc7-a42b-31640b614086",
              "name": "timer",
              "value": "=1",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "fe83d8fd-e444-4b62-ab12-886c3423d369",
      "name": "Edit Fields4",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.3,
      "position": [
        4640,
        960
      ]
    },
    {
      "parameters": {
        "amount": "={{ Math.random()*10 + $json[\"timer\"] }}",
        "unit": "seconds"
      },
      "id": "0d1a7878-9d9b-4597-9b9f-8fba4d44bcd0",
      "name": "Wait3",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1,
      "position": [
        2920,
        1200
      ],
      "webhookId": "ba4a9966-c43b-4b8d-8fdc-211899cf3077"
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Traks",
          "mode": "list",
          "cachedResultName": "Traks"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "Track",
        "valueToMatchOn": "={{ $json.data[0].number }}",
        "valuesToSend": {
          "values": [
            {
              "column": "Status",
              "value": "=Доставлено"
            },
            {
              "column": "DateLastUpd",
              "value": "={{ $now.format('yyyy-MM-dd') }}"
            },
            {
              "column": "History",
              "value": "={{ JSON.stringify($json.data[0].steps) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "86f27091-c7a4-45f8-971f-c66158ee946e",
      "name": "Выставляем в БД табл Traks статус Доставлено",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        4140,
        380
      ],
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Traks",
          "mode": "list",
          "cachedResultName": "Traks"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "Track",
        "valueToMatchOn": "={{ $json.data[0].number }}",
        "valuesToSend": {
          "values": [
            {
              "column": "Status",
              "value": "=Вручено отправителю"
            }
          ]
        },
        "options": {}
      },
      "id": "8de555a3-bd4f-4faa-92d8-14bd60032b2c",
      "name": "Выставляем в БД табл Traks статус Доставлено отправителю",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        3980,
        620
      ],
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Traks",
          "mode": "list",
          "cachedResultName": "Traks"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "Track",
        "valueToMatchOn": "={{ $json.data[0].number }}",
        "valuesToSend": {
          "values": [
            {
              "column": "Status",
              "value": "=Не доставлено"
            },
            {
              "column": "DateLastUpd",
              "value": "={{ $now.format('yyyy-MM-dd') }}"
            },
            {
              "column": "History",
              "value": "={{ JSON.stringify($json.data[0].steps) }}"
            }
          ]
        },
        "options": {}
      },
      "id": "0321670f-170f-48ca-acc0-d959f220e301",
      "name": "Выставляем в БД табл Traks статус Доставлено1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        3700,
        940
      ],
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "b3454bbf-9770-469d-a03c-a522670bec5a",
      "name": "Date & Time",
      "type": "n8n-nodes-base.dateTime",
      "typeVersion": 2,
      "position": [
        1840,
        220
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "130997e0-9937-4e87-ac6b-a30e673b0c8a",
              "leftValue": false,
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "fe680f3c-bcbf-47ec-962e-bb5b454b7ace",
      "name": "If",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2100,
        220
      ]
    },
    {
      "parameters": {},
      "id": "5b0eda1e-d8be-450a-9889-0a2de0e462d5",
      "name": "No Operation, do nothing",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        4880,
        960
      ]
    },
    {
      "parameters": {},
      "id": "56bfd57b-9169-4b3b-a8e8-0967a8b1dfb5",
      "name": "Отправляем уведомление об окончании проверки",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1980,
        -260
      ]
    },
    {
      "parameters": {},
      "id": "6dfb0a23-f0e1-42ed-a842-66449993b563",
      "name": "Произведём логические расчёты для Servers в БД",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        1220,
        120
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b78f8de6-4c96-4704-a9a2-d80d429f48f0",
              "name": "items",
              "value": "={{ $input.all().length }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "id": "99d36be3-1e18-4fe6-9ce3-66e8cdfe4681",
      "name": "Edit Fields2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1080,
        -80
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Servers",
          "mode": "list",
          "cachedResultName": "Servers"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "Server_name",
        "valueToMatchOn": "={{ $('Данные процесса').item.json.Server }}",
        "valuesToSend": {
          "values": [
            {
              "column": "All_traks",
              "value": "={{ $json.items }}"
            },
            {
              "column": "Traks_left",
              "value": "={{ $json.items }}"
            }
          ]
        },
        "options": {}
      },
      "id": "9d9a43dd-7216-46aa-9caf-76f239422c7d",
      "name": "Закидываем колличество треков в таблицу Servers для сервера BP_1",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1320,
        -80
      ],
      "executeOnce": true,
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ae808ddb-2e36-49bd-a7de-e5826056fac8",
              "leftValue": false,
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "363cc8a8-fc07-47c8-9f50-ea0dd7911c9a",
      "name": "If2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1520,
        -80
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Servers",
          "mode": "list",
          "cachedResultName": "Servers"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "Server_name",
        "valueToMatchOn": "={{ $('Данные процесса').item.json.Server }}",
        "valuesToSend": {
          "values": [
            {
              "column": "Traks_left",
              "value": "={{ $json.items }}"
            }
          ]
        },
        "options": {}
      },
      "id": "2c6ed30c-b74e-419a-a460-1041c3aec28c",
      "name": "Закидываем колличество треков в таблицу Servers для сервера BP_",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        740,
        -280
      ],
      "executeOnce": true,
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "content": "## меняем счётчик оставшихся треков",
        "height": 80,
        "width": 494.0052728237823
      },
      "id": "40298cb8-a1ab-44da-89e7-e107ef82684e",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1740,
        880
      ]
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "Servers",
          "mode": "list",
          "cachedResultName": "Servers"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "Server_name",
              "value": "={{ $('Данные процесса').item.json.Server }}"
            }
          ]
        },
        "options": {}
      },
      "id": "ce8281ab-8e69-4b0f-8bac-b32f58ff5d57",
      "name": "Получить все записи из таблицы Servers",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1720,
        1020
      ],
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Servers",
          "mode": "list",
          "cachedResultName": "Servers"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "Server_name",
        "valueToMatchOn": "={{ $('Данные процесса').item.json.Server }}",
        "valuesToSend": {
          "values": [
            {
              "column": "Traks_left",
              "value": "={{ $json.Traks_left - 1}}"
            },
            {
              "column": "All_traks",
              "value": "={{ $json.All_traks - 1 }}"
            }
          ]
        },
        "options": {}
      },
      "id": "f07af3ba-12ee-4286-93a7-a3521cccb0b2",
      "name": "Уменьшаем на 1 количество оставшихся треков",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        2120,
        1020
      ],
      "executeOnce": true,
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "table": {
          "__rl": true,
          "value": "Servers",
          "mode": "list",
          "cachedResultName": "Servers"
        },
        "returnAll": true,
        "where": {
          "values": [
            {
              "column": "Server_name",
              "value": "={{ $json.Server }}"
            }
          ]
        },
        "options": {}
      },
      "id": "2e1576a0-73b7-4a20-8c17-a6ea6583593e",
      "name": "Получить все записи из таблицы Servers для BP_X",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        820,
        340
      ],
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e68fd29a-2217-4dde-b045-ab192fb6faa5",
              "name": "body",
              "value": "={{ $json.TrFch }}",
              "type": "array"
            },
            {
              "id": "a30fdad0-ff52-4362-be0a-c75f6e2d6294",
              "name": "",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "2539f676-36ba-45e0-809e-eec5870bc146",
      "name": "Получаем треки в массив",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1000,
        340
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a30fdad0-ff52-4362-be0a-c75f6e2d6294",
              "name": "Server",
              "value": "EP_1",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "bc51f15e-e70d-4e46-b977-a337e13907ce",
      "name": "Данные процесса",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        620,
        340
      ]
    },
    {
      "parameters": {
        "url": "=https://api-kassa.evropochta.by/api/ops/postal/tracking/{{ $json.Track }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "authority",
              "value": "api-kassa.evropochta.by"
            },
            {
              "name": "accept",
              "value": "application/json, text/plain, */*"
            },
            {
              "name": "accept-language",
              "value": "ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7"
            },
            {
              "name": "operatoropstoken",
              "value": "DzjvfymAsXmy2LGMJy0KK6e84ZKbh1FZ"
            },
            {
              "name": "origin",
              "value": "https://evropochta.by"
            },
            {
              "name": "referer",
              "value": "https://evropochta.by/"
            },
            {
              "name": "sec-ch-ua",
              "value": "\"Not A(Brand\";v=\"99\", \"Google Chrome\";v=\"121\", \"Chromium\";v=\"121\""
            },
            {
              "name": "sec-ch-ua-mobile",
              "value": "?0"
            },
            {
              "name": "sec-ch-ua-platform",
              "value": "\"Windows\""
            },
            {
              "name": "sec-fetch-dest",
              "value": "empty"
            },
            {
              "name": "sec-fetch-mode",
              "value": "cors"
            },
            {
              "name": "sec-fetch-site",
              "value": "same-site"
            },
            {
              "name": "user-agent",
              "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36"
            }
          ]
        },
        "options": {}
      },
      "id": "c008e2d9-5486-4e7c-9182-c0ad02a57045",
      "name": "HTTP Request1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        2180,
        440
      ],
      "retryOnFail": true,
      "waitBetweenTries": 2000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "3fa00307-1cae-45c9-a495-4b1cbe68261a",
      "name": "Aggregate",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        3320,
        300
      ]
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "employee_info"
            },
            {
              "fieldToAggregate": "client_info"
            }
          ]
        },
        "options": {}
      },
      "id": "5eaafa24-2a53-4ccc-9738-39c88d052dc0",
      "name": "Aggregate1",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2280,
        40
      ]
    },
    {
      "parameters": {
        "fieldToSplitOut": "employee_info, client_info",
        "include": "allOtherFields",
        "options": {}
      },
      "id": "51cdd5cb-123d-45a2-95c3-9c947199166b",
      "name": "Split Out",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2440,
        180
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "83aa88d1-e4d0-4c1f-ba09-40763d804b1e",
      "name": "Aggregate2",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2760,
        180
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "938e218a-ed37-4303-b047-10be5128b7bb",
              "name": "last_status",
              "value": "={{ $json.client_info }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "7e670ca4-4540-47cf-974b-00a1a3b2bc48",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2880,
        420
      ],
      "executeOnce": true
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "timeX",
              "order": "descending"
            }
          ]
        },
        "options": {}
      },
      "id": "cf4c8872-dadb-4b06-b1e4-7cced1f42733",
      "name": "Sort",
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        2560,
        420
      ]
    },
    {
      "parameters": {},
      "id": "f6a51b46-8864-4509-a8cd-f154374a2f63",
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        3160,
        400
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "table": {
          "__rl": true,
          "value": "Servers",
          "mode": "list",
          "cachedResultName": "Servers"
        },
        "dataMode": "defineBelow",
        "columnToMatchOn": "Server_name",
        "valueToMatchOn": "={{ $('Данные процесса').item.json.Server }}",
        "valuesToSend": {
          "values": [
            {
              "column": "Status_Work",
              "value": "0"
            }
          ]
        },
        "options": {}
      },
      "id": "dddef527-d9f8-4885-939c-ae9be4881f01",
      "name": "выставляем status work - 0",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.4,
      "position": [
        1720,
        -260
      ],
      "executeOnce": true,
      "credentials": {
        "mySql": {
          "id": "8aCpW2vOoONBz7HE",
          "name": "MySQL account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c4537afc-1288-4793-90e5-dc1192e4b985",
              "name": "number",
              "value": "={{ $('Трэк в цикле').item.json.Track }}",
              "type": "string"
            },
            {
              "id": "694bfdba-5419-46ac-af61-233d9dee5316",
              "name": "last_event",
              "value": "={{ $json.data[1].last_status }}",
              "type": "string"
            },
            {
              "id": "5a20f685-f36c-46c2-b690-f5ff0a9d49fc",
              "name": "steps",
              "value": "={{ $json.data[0].data }}",
              "type": "array"
            }
          ]
        },
        "options": {}
      },
      "id": "092aa735-15da-4f37-a366-7519aa6e1564",
      "name": "Edit Fields5",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3480,
        400
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0225f2ec-c831-4bf4-b315-4e10c39bd1b0",
              "leftValue": "={{ $json.last_event }}",
              "rightValue": "выдано",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "739c90fc-dde7-4f83-af30-41a978610c37",
      "name": "If4",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3680,
        400
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "eb922e4d-d3d6-4771-bdaf-4dc42fa33eea",
              "leftValue": "={{ $json.last_event }}",
              "rightValue": "возвращено отправителю",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            },
            {
              "id": "db6ee1ec-e11c-4b77-900c-a86f6e7d0067",
              "leftValue": "={{ $json.last_event }}",
              "rightValue": "будет возвращено отправителю",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "id": "b79102a3-1b1b-428c-aed4-1cd70ffc985d",
      "name": "If5",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3720,
        640
      ]
    },
    {
      "parameters": {
        "path": "check_trackEP1",
        "options": {}
      },
      "id": "25676d0c-bf95-42f2-b512-9e065285ea42",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        320,
        340
      ],
      "webhookId": "9511889c-228b-4775-bd00-c430f4161789"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2024-11-09T11:35:21.000Z",
  "versionId": "570e8441-b43b-438a-a0ab-30522e19bdfd"
}